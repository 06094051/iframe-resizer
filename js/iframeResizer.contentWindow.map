{"version":3,"file":"iframeResizer.contentWindow.min.js","sources":["../src/iframeResizer.contentWindow.js"],"names":["addEventListener","el","evt","func","window","attachEvent","formatLogMsg","msg","msgID","myID","log","logging","console","warn","init","readData","location","href","setMargin","setBodyStyle","bodyBackground","bodyPadding","injectClearFixIntoBodyElement","checkHeightMode","checkWidthMode","stopInfiniteResizingOfIFrame","setupPublicMethods","startEventListeners","inPageLinks","setupInPageLinks","sendSize","strBool","str","data","initMsg","substr","msgIdLen","split","bodyMargin","undefined","Number","calculateWidth","interval","publicMethods","autoResize","bodyMarginStr","heightCalcMode","tolerance","enable","resizeFrom","widthCalcMode","chkCSS","attr","value","indexOf","document","body","style","documentElement","height","addTriggerEvent","options","addListener","eventName","handleEvent","eventType","eventNames","Array","prototype","map","initEventListeners","checkCalcMode","calcMode","calcModeDefault","modes","type","heightCalcModeDefault","getHeight","widthCalcModeDefault","getWidth","setupMutationObserver","clearFix","createElement","clear","display","appendChild","getPagePosition","x","pageXOffset","scrollLeft","y","pageYOffset","scrollTop","getElementPosition","elPosition","getBoundingClientRect","pagePosition","parseInt","left","top","findTarget","jumpToTarget","target","jumpPosition","hash","sendMsg","hashData","decodeURIComponent","getElementById","getElementsByName","checkLocationHash","bindAnchors","setupLink","linkClicked","e","preventDefault","this","getAttribute","forEach","call","querySelectorAll","bindLocationHash","initCheck","setTimeout","eventCancelTimer","enableInPageLinks","parentIFrame","close","getId","moveToAnchor","reset","resetIFrame","scrollTo","scrollToOffset","sendMessage","targetOrigin","JSON","stringify","setHeightCalculationMethod","heightCalculationMethod","setTargetOrigin","targetOriginDefault","size","customHeight","customWidth","valString","lockTrigger","initInterval","setInterval","Math","abs","isNotSet","item","addImageLoadListners","mutation","addImageLoadListener","element","imageLoaded","bind","width","src","attributeName","mutationObserved","mutations","createMutationObserver","querySelector","config","attributes","attributeOldValue","characterData","characterDataOldValue","childList","subtree","observer","MutationObserver","observe","forceIntervalTimer","WebKitMutationObserver","getComputedBodyStyle","prop","convertUnitsToPxForIE8","PIXEL","test","base","runtimeStyle","currentStyle","pixelLeft","retVal","defaultView","getComputedStyle","getMaxElement","side","elements","elementsLength","length","maxVal","timer","Date","getTime","i","getAllHeights","bodyOffset","bodyScroll","documentElementOffset","documentElementScroll","getTaggedElements","tag","noTaggedElementsFound","getAllElements","triggerEvent","triggerEventDesc","recordTrigger","resetPage","resizeIFrame","currentHeight","currentWidth","isDoubleFiredEvent","triggerLocked","doubleEventList","isSizeChangeDetected","checkTolarance","a","b","isForceResizableEvent","isForceResizableHeightCalcMode","resetRequiredMethods","logIgnored","checkDownSizing","clearTimeout","triggerLockedTimer","triggerReset","hcm","sendToParent","message","postMessage","receiver","event","isMessageForUs","initFromParent","source","firstRun","initLock","resetFromParent","resizeFromParent","getMessageType","isMiddleTier","isInitMsg","true","false","resize","click","max","scroll","parent","offsetHeight","offset","scrollHeight","apply","min","grow","lowestElement","taggedElement","scrollWidth","leftMostElement"],"mappings":"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","sourcesContent":["/*\n * File: iframeResizer.contentWindow.js\n * Desc: Include this file in any page being loaded into an iframe\n *       to force the iframe to resize to the content size.\n * Requires: iframeResizer.js on host page.\n * Doc: https://github.com/davidjbradshaw/iframe-resizer\n * Author: David J. Bradshaw - dave@bradshaw.net\n * Contributor: Jure Mav - jure.mav@gmail.com\n * Contributor: Ian Caunce - ian@hallnet.co.uk\n */\n\n;(function() {\n\t'use strict';\n\n\tvar\n\t\tautoResize            = true,\n\t\tbase                  = 10,\n\t\tbodyBackground        = '',\n\t\tbodyMargin            = 0,\n\t\tbodyMarginStr         = '',\n\t\tbodyPadding           = '',\n\t\tcalculateWidth        = false,\n\t\tdoubleEventList       = {'resize':1,'click':1},\n\t\teventCancelTimer      = 128,\n\t\tfirstRun              = true,\n\t\theight                = 1,\n\t\theightCalcModeDefault = 'bodyOffset',\n\t\theightCalcMode        = heightCalcModeDefault,\n\t\tinitLock              = true,\n\t\tinitMsg               = '',\n\t\tinPageLinks           = {},\n\t\tinterval              = 32,\n\t\tlogging               = false,\n\t\tmsgID                 = '[iFrameSizer]',  //Must match host page msg ID\n\t\tmsgIdLen              = msgID.length,\n\t\tmyID                  = '',\n\t\tpublicMethods         = false,\n\t\tresetRequiredMethods  = {max:1,scroll:1,bodyScroll:1,documentElementScroll:1},\n\t\tresizeFrom            = 'child',\n\t\ttargetOriginDefault   = '*',\n\t\ttarget                = window.parent,\n\t\ttolerance             = 0,\n\t\ttriggerLocked         = false,\n\t\ttriggerLockedTimer    = null,\n\t\twidth                 = 1,\n\t\twidthCalcModeDefault  = 'max',\n\t\twidthCalcMode         = widthCalcModeDefault;\n\n\n\tfunction addEventListener(el,evt,func){\n\t\tif ('addEventListener' in window){\n\t\t\tel.addEventListener(evt,func, false);\n\t\t} else if ('attachEvent' in window){ //IE\n\t\t\tel.attachEvent('on'+evt,func);\n\t\t}\n\t}\n\n\tfunction formatLogMsg(msg){\n\t\treturn msgID + '[' + myID + ']' + ' ' + msg;\n\t}\n\n\tfunction log(msg){\n\t\tif (logging && ('object' === typeof window.console)){\n\t\t\tconsole.log(formatLogMsg(msg));\n\t\t}\n\t}\n\n\tfunction warn(msg){\n\t\tif ('object' === typeof window.console){\n\t\t\tconsole.warn(formatLogMsg(msg));\n\t\t}\n\t}\n\n\n\tfunction init(){\n\t\treadData();\n\t\tlog('Initialising iFrame ('+location.href+')');\n\t\tsetMargin();\n\t\tsetBodyStyle('background',bodyBackground);\n\t\tsetBodyStyle('padding',bodyPadding);\n\t\tinjectClearFixIntoBodyElement();\n\t\tcheckHeightMode();\n\t\tcheckWidthMode();\n\t\tstopInfiniteResizingOfIFrame();\n\t\tsetupPublicMethods();\n\t\tstartEventListeners();\n\t\tinPageLinks = setupInPageLinks();\n\t\tsendSize('init','Init message from host page');\n\t}\n\n\tfunction readData(){\n\n\t\tvar data = initMsg.substr(msgIdLen).split(':');\n\n\t\tfunction strBool(str){\n\t\t\treturn 'true' === str ? true : false;\n\t\t}\n\n\t\tmyID               = data[0];\n\t\tbodyMargin         = (undefined !== data[1]) ? Number(data[1])   : bodyMargin; //For V1 compatibility\n\t\tcalculateWidth     = (undefined !== data[2]) ? strBool(data[2])  : calculateWidth;\n\t\tlogging            = (undefined !== data[3]) ? strBool(data[3])  : logging;\n\t\tinterval           = (undefined !== data[4]) ? Number(data[4])   : interval;\n\t\tpublicMethods      = (undefined !== data[5]) ? strBool(data[5])  : publicMethods;\n\t\tautoResize         = (undefined !== data[6]) ? strBool(data[6])  : autoResize;\n\t\tbodyMarginStr      = data[7];\n\t\theightCalcMode     = (undefined !== data[8]) ? data[8]           : heightCalcMode;\n\t\tbodyBackground     = data[9];\n\t\tbodyPadding        = data[10];\n\t\ttolerance          = (undefined !== data[11]) ? Number(data[11]) : tolerance;\n\t\tinPageLinks.enable = (undefined !== data[12]) ? strBool(data[12]): false;\n\t\tresizeFrom         = (undefined !== data[13]) ? data[13]         : resizeFrom;\n\t\twidthCalcMode      = (undefined !== data[14]) ? data[14]         : widthCalcMode;\n\t}\n\n\tfunction chkCSS(attr,value){\n\t\tif (-1 !== value.indexOf('-')){\n\t\t\twarn('Negative CSS value ignored for '+attr);\n\t\t\tvalue='';\n\t\t}\n\t\treturn value;\n\t}\n\n\tfunction setBodyStyle(attr,value){\n\t\tif ((undefined !== value) && ('' !== value) && ('null' !== value)){\n\t\t\tdocument.body.style[attr] = value;\n\t\t\tlog('Body '+attr+' set to \"'+value+'\"');\n\t\t}\n\t}\n\n\tfunction setMargin(){\n\t\t//If called via V1 script, convert bodyMargin from int to str\n\t\tif (undefined === bodyMarginStr){\n\t\t\tbodyMarginStr = bodyMargin+'px';\n\t\t}\n\t\tchkCSS('margin',bodyMarginStr);\n\t\tsetBodyStyle('margin',bodyMarginStr);\n\t}\n\n\tfunction stopInfiniteResizingOfIFrame(){\n\t\tdocument.documentElement.style.height = '';\n\t\tdocument.body.style.height = '';\n\t\tlog('HTML & body height set to \"auto\"');\n\t}\n\n\n\tfunction addTriggerEvent(options){\n\t\tfunction addListener(eventName){\n\t\t\tfunction handleEvent(){\n\t\t\t\tsendSize(options.eventName,options.eventType);\n\t\t\t}\n\n\t\t\taddEventListener(window,eventName,handleEvent);\n\t\t}\n\n\t\tif(options.eventNames && Array.prototype.map){\n\t\t\toptions.eventName = options.eventNames[0];\n\t\t\toptions.eventNames.map(addListener);\n\t\t} else {\n\t\t\taddListener(options.eventName);\n\t\t}\n\n\t\tlog('Added event listener: ' + options.eventType);\n\t}\n\n\tfunction initEventListeners(){\n\t\taddTriggerEvent({ eventType: 'Animation Start',           eventNames: ['animationstart','webkitAnimationStart'] });\n\t\taddTriggerEvent({ eventType: 'Animation Iteration',       eventNames: ['animationiteration','webkitAnimationIteration'] });\n\t\taddTriggerEvent({ eventType: 'Animation End',             eventNames: ['animationend','webkitAnimationEnd'] });\n\t\taddTriggerEvent({ eventType: 'Orientation Change',        eventName:  'orientationchange' });\n\t\taddTriggerEvent({ eventType: 'Transition End',            eventNames: ['transitionend','webkitTransitionEnd','MSTransitionEnd','oTransitionEnd','otransitionend'] });\n\t\taddTriggerEvent({ eventType: 'Window Clicked',            eventName:  'click' });\n\t\t//addTriggerEvent({ eventType: 'Window Mouse Down',         eventName:  'mousedown' });\n\t\t//addTriggerEvent({ eventType: 'Window Mouse Up',           eventName:  'mouseup' });\n\t\tif('child' === resizeFrom){\n\t\t\taddTriggerEvent({ eventType: 'IFrame Resized',        eventName:  'resize' });\n\t\t}\n\t}\n\n\tfunction checkCalcMode(calcMode,calcModeDefault,modes,type){\n\t\tif (calcModeDefault !== calcMode){\n\t\t\tif (!(calcMode in modes)){\n\t\t\t\twarn(calcMode + ' is not a valid option for '+type+'CalculationMethod.');\n\t\t\t\tcalcMode=calcModeDefault;\n\t\t\t}\n\t\t\tlog(type+' calculation method set to \"'+calcMode+'\"');\n\t\t}\n\t}\n\n\tfunction checkHeightMode(){\n\t\tcheckCalcMode(heightCalcMode,heightCalcModeDefault,getHeight,'height');\n\t}\n\n\tfunction checkWidthMode(){\n\t\tcheckCalcMode(widthCalcMode,widthCalcModeDefault,getWidth,'width');\n\t}\n\n\tfunction startEventListeners(){\n\t\tif ( true === autoResize ) {\n\t\t\tinitEventListeners();\n\t\t\tsetupMutationObserver();\n\t\t}\n\t\telse {\n\t\t\tlog('Auto Resize disabled');\n\t\t}\n\t}\n\n\tfunction injectClearFixIntoBodyElement(){\n\t\tvar clearFix = document.createElement('div');\n\t\tclearFix.style.clear = 'both';\n\t\tclearFix.style.display = 'block'; //Guard against this having been globally redefined in CSS.\n\t\tdocument.body.appendChild(clearFix);\n\t}\n\n\tfunction setupInPageLinks(){\n\n\t\tfunction getPagePosition (){\n\t\t\treturn {\n\t\t\t\tx: (window.pageXOffset !== undefined) ? window.pageXOffset : document.documentElement.scrollLeft,\n\t\t\t\ty: (window.pageYOffset !== undefined) ? window.pageYOffset : document.documentElement.scrollTop\n\t\t\t};\n\t\t}\n\n\t\tfunction getElementPosition(el){\n\t\t\tvar\n\t\t\t\telPosition   = el.getBoundingClientRect(),\n\t\t\t\tpagePosition = getPagePosition();\n\n\t\t\treturn {\n\t\t\t\tx: parseInt(elPosition.left,10) + parseInt(pagePosition.x,10),\n\t\t\t\ty: parseInt(elPosition.top,10)  + parseInt(pagePosition.y,10)\n\t\t\t};\n\t\t}\n\n\t\tfunction findTarget(location){\n\t\t\tvar hash = location.split('#')[1] || '';\n\t\t\tvar hashData = decodeURIComponent(hash);\n\n\t\t\tfunction jumpToTarget(target){\n\t\t\t\tvar jumpPosition = getElementPosition(target);\n\n\t\t\t\tlog('Moving to in page link (#'+hash+') at x: '+jumpPosition.x+' y: '+jumpPosition.y);\n\t\t\t\tsendMsg(jumpPosition.y, jumpPosition.x, 'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n\t\t\t}\n\n\t\t\tvar target = document.getElementById(hashData) || document.getElementsByName(hashData)[0];\n\n\t\t\tif (target){\n\t\t\t\tjumpToTarget(target);\n\t\t\t} else {\n\t\t\t\tlog('In page link (#' + hash + ') not found in iFrame, so sending to parent');\n\t\t\t\tsendMsg(0,0,'inPageLink','#'+hash);\n\t\t\t}\n\t\t}\n\n\t\tfunction checkLocationHash(){\n\t\t\tif ('' !== location.hash && '#' !== location.hash){\n\t\t\t\tfindTarget(location.href);\n\t\t\t}\n\t\t}\n\n\t\tfunction bindAnchors(){\n\t\t\tfunction setupLink(el){\n\t\t\t\tfunction linkClicked(e){\n\t\t\t\t\te.preventDefault();\n\n\t\t\t\t\t/*jshint validthis:true */\n\t\t\t\t\tfindTarget(this.getAttribute('href'));\n\t\t\t\t}\n\n\t\t\t\tif ('#' !== el.getAttribute('href')){\n\t\t\t\t\taddEventListener(el,'click',linkClicked);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tArray.prototype.forEach.call( document.querySelectorAll( 'a[href^=\"#\"]' ), setupLink );\n\t\t}\n\n\t\tfunction bindLocationHash(){\n\t\t\taddEventListener(window,'hashchange',checkLocationHash);\n\t\t}\n\n\t\tfunction initCheck(){ //check if page loaded with location hash after init resize\n\t\t\tsetTimeout(checkLocationHash,eventCancelTimer);\n\t\t}\n\n\t\tfunction enableInPageLinks(){\n\t\t\tif(Array.prototype.forEach && document.querySelectorAll){\n\t\t\t\tlog('Setting up location.hash handlers');\n\t\t\t\tbindAnchors();\n\t\t\t\tbindLocationHash();\n\t\t\t\tinitCheck();\n\t\t\t} else {\n\t\t\t\twarn('In page linking not fully supported in this browser! (See README.md for IE8 workaround)');\n\t\t\t}\n\t\t}\n\n\t\tif(inPageLinks.enable){\n\t\t\tenableInPageLinks();\n\t\t} else {\n\t\t\tlog('In page linking not enabled');\n\t\t}\n\n\t\treturn {\n\t\t\tfindTarget:findTarget\n\t\t};\n\t}\n\n\tfunction setupPublicMethods(){\n\t\tif (publicMethods) {\n\t\t\tlog('Enable public methods');\n\n\t\t\twindow.parentIFrame = {\n\t\t\t\tclose: function closeF(){\n\t\t\t\t\tsendMsg(0,0,'close');\n\t\t\t\t},\n\n\t\t\t\tgetId: function getIdF(){\n\t\t\t\t\treturn myID;\n\t\t\t\t},\n\n\t\t\t\tmoveToAnchor: function moveToAnchorF(hash){\n\t\t\t\t\tinPageLinks.findTarget(hash);\n\t\t\t\t},\n\n\t\t\t\treset: function resetF(){\n\t\t\t\t\tresetIFrame('parentIFrame.reset');\n\t\t\t\t},\n\n\t\t\t\tscrollTo: function scrollToF(x,y){\n\t\t\t\t\tsendMsg(y,x,'scrollTo'); // X&Y reversed at sendMsg uses height/width\n\t\t\t\t},\n\n\t\t\t\tscrollToOffset: function scrollToF(x,y){\n\t\t\t\t\tsendMsg(y,x,'scrollToOffset'); // X&Y reversed at sendMsg uses height/width\n\t\t\t\t},\n\n\t\t\t\tsendMessage: function sendMessageF(msg,targetOrigin){\n\t\t\t\t\tsendMsg(0,0,'message',JSON.stringify(msg),targetOrigin);\n\t\t\t\t},\n\n\t\t\t\tsetHeightCalculationMethod: function setHeightCalculationMethodF(heightCalculationMethod){\n\t\t\t\t\theightCalcMode = heightCalculationMethod;\n\t\t\t\t\tcheckHeightMode();\n\t\t\t\t},\n\n\t\t\t\tsetTargetOrigin: function setTargetOriginF(targetOrigin){\n\t\t\t\t\tlog('Set targetOrigin: '+targetOrigin);\n\t\t\t\t\ttargetOriginDefault = targetOrigin;\n\t\t\t\t},\n\n\t\t\t\tsize: function sizeF(customHeight, customWidth){\n\t\t\t\t\tvar valString = ''+(customHeight?customHeight:'')+(customWidth?','+customWidth:'');\n\t\t\t\t\tlockTrigger();\n\t\t\t\t\tsendSize('size','parentIFrame.size('+valString+')', customHeight, customWidth);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction initInterval(){\n\t\tif ( 0 !== interval ){\n\t\t\tlog('setInterval: '+interval+'ms');\n\t\t\tsetInterval(function(){\n\t\t\t\tsendSize('interval','setInterval: '+interval);\n\t\t\t},Math.abs(interval));\n\t\t}\n\t}\n\n\tfunction isNotSet(item){\n\t\treturn undefined === item || 0 === item;\n\t}\n\n\tfunction setupMutationObserver(){\n\t\tfunction addImageLoadListners(mutation) {\n\t\t\tfunction addImageLoadListener(element){\n\t\t\t\tvar imageLoaded = sendSize.bind(null,'imageLoad','Image loaded',undefined,undefined);\n\n\t\t\t\tif (isNotSet(element.height) || isNotSet(element.width)) {\n\t\t\t\t\tlog('Attach listerner to ' + element.src);\n\t\t\t\t\telement.addEventListener('load', imageLoaded, false);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (mutation.type === 'attributes' && mutation.attributeName === 'src'){\n\t\t\t\taddImageLoadListener(mutation.target);\n\t\t\t} else if (mutation.type === 'childList'){\n\t\t\t\tArray.prototype.forEach.call(\n\t\t\t\t\tmutation.target.querySelectorAll('img'), \n\t\t\t\t\taddImageLoadListener\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfunction mutationObserved(mutations) {\n\t\t\tsendSize('mutationObserver','mutationObserver: ' + mutations[0].target + ' ' + mutations[0].type);\n\n\t\t\t//Deal with WebKit asyncing image loading when tags are injected into the page\n\t\t\taddImageLoadListners(mutations[0]);\n\t\t}\n\n\t\tfunction createMutationObserver(){\n\t\t\tvar\n\t\t\t\ttarget = document.querySelector('body'),\n\n\t\t\t\tconfig = {\n\t\t\t\t\tattributes            : true,\n\t\t\t\t\tattributeOldValue     : false,\n\t\t\t\t\tcharacterData         : true,\n\t\t\t\t\tcharacterDataOldValue : false,\n\t\t\t\t\tchildList             : true,\n\t\t\t\t\tsubtree               : true\n\t\t\t\t},\n\n\t\t\t\tobserver = new MutationObserver(mutationObserved);\n\n\t\t\tlog('Enable MutationObserver');\n\t\t\tobserver.observe(target, config);\n\t\t}\n\n\t\tvar\n\t\t\tforceIntervalTimer = 0 > interval,\n\t\t\tMutationObserver   = window.MutationObserver || window.WebKitMutationObserver;\n\n\t\tif (MutationObserver){\n\t\t\tif (forceIntervalTimer) {\n\t\t\t\tinitInterval();\n\t\t\t} else {\n\t\t\t\tcreateMutationObserver();\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\twarn('MutationObserver not supported in this browser!');\n\t\t\tinitInterval();\n\t\t}\n\t}\n\n\n\t// document.documentElement.offsetHeight is not reliable, so\n\t// we have to jump through hoops to get a better value.\n\tfunction getComputedBodyStyle(prop) {\n\t\tfunction convertUnitsToPxForIE8(value) {\n\t\t\tvar PIXEL = /^\\d+(px)?$/i;\n\n\t\t\tif (PIXEL.test(value)) {\n\t\t\t\treturn parseInt(value,base);\n\t\t\t}\n\n\t\t\tvar\n\t\t\t\tstyle = el.style.left,\n\t\t\t\truntimeStyle = el.runtimeStyle.left;\n\n\t\t\tel.runtimeStyle.left = el.currentStyle.left;\n\t\t\tel.style.left = value || 0;\n\t\t\tvalue = el.style.pixelLeft;\n\t\t\tel.style.left = style;\n\t\t\tel.runtimeStyle.left = runtimeStyle;\n\n\t\t\treturn value;\n\t\t}\n\n\t\tvar\n\t\t\tel = document.body,\n\t\t\tretVal = 0;\n\n\t\tif (('defaultView' in document) && ('getComputedStyle' in document.defaultView)) {\n\t\t\tretVal = document.defaultView.getComputedStyle(el, null);\n\t\t\tretVal = (null !== retVal) ? retVal[prop] : 0;\n\t\t} else {//IE8\n\t\t\tretVal =  convertUnitsToPxForIE8(el.currentStyle[prop]);\n\t\t}\n\n\t\treturn parseInt(retVal,base);\n\t}\n\n\t//Idea from https://github.com/guardian/iframe-messenger\n\tfunction getMaxElement(side,elements) {\n\t\tvar\n\t\t\telementsLength = elements.length,\n\t\t\tmaxVal         = 0,\n\t\t\ttimer          = new Date().getTime();\n\n\t\tfor (var i = 0; i < elementsLength; i++) {\n\t\t\tif (elements[i].getBoundingClientRect()[side] > maxVal) {\n\t\t\t\tmaxVal = elements[i].getBoundingClientRect()[side];\n\t\t\t}\n\t\t}\n\n\t\ttimer = new Date().getTime() - timer;\n\n\t\tlog('Parsed '+elementsLength+' HTML elements');\n\t\tlog('Element position calculated in ' + timer + 'ms');\n\n\t\treturn maxVal;\n\t}\n\n\tfunction getAllHeights(){\n\t\treturn [\n\t\t\tgetHeight.bodyOffset(),\n\t\t\tgetHeight.bodyScroll(),\n\t\t\tgetHeight.documentElementOffset(),\n\t\t\tgetHeight.documentElementScroll()\n\t\t];\n\t}\n\n\tfunction getTaggedElements(side,tag){\n\t\tfunction noTaggedElementsFound(){\n\t\t\twarn('No tagged elements ('+tag+') found on page');\n\t\t\treturn height; //current height\n\t\t}\n\n\t\tvar elements = document.querySelectorAll('['+tag+']');\n\n\t\treturn 0 === elements.length ?  noTaggedElementsFound() : getMaxElement(side,elements);\n\t}\n\n\tfunction getAllElements(){\n\t\treturn document.querySelectorAll('body *');\n\t}\n\n\tvar\n\t\tgetHeight = {\n\t\t\tbodyOffset: function getBodyOffsetHeight(){\n\t\t\t\treturn  document.body.offsetHeight + getComputedBodyStyle('marginTop') + getComputedBodyStyle('marginBottom');\n\t\t\t},\n\n\t\t\toffset: function(){\n\t\t\t\treturn getHeight.bodyOffset(); //Backwards compatability\n\t\t\t},\n\n\t\t\tbodyScroll: function getBodyScrollHeight(){\n\t\t\t\treturn document.body.scrollHeight;\n\t\t\t},\n\n\t\t\tdocumentElementOffset: function getDEOffsetHeight(){\n\t\t\t\treturn document.documentElement.offsetHeight;\n\t\t\t},\n\n\t\t\tdocumentElementScroll: function getDEScrollHeight(){\n\t\t\t\treturn document.documentElement.scrollHeight;\n\t\t\t},\n\n\t\t\tmax: function getMaxHeight(){\n\t\t\t\treturn Math.max.apply(null,getAllHeights());\n\t\t\t},\n\n\t\t\tmin: function getMinHeight(){\n\t\t\t\treturn Math.min.apply(null,getAllHeights());\n\t\t\t},\n\n\t\t\tgrow: function growHeight(){\n\t\t\t\treturn getHeight.max(); //Run max without the forced downsizing\n\t\t\t},\n\n\t\t\tlowestElement: function getBestHeight(){\n\t\t\t\treturn Math.max(getHeight.bodyOffset(), getMaxElement('bottom',getAllElements()));\n\t\t\t},\n\n\t\t\ttaggedElement: function getTaggedElementsHeight(){\n\t\t\t\treturn getTaggedElements('bottom','data-iframe-height');\n\t\t\t}\n\t\t},\n\n\t\tgetWidth = {\n\t\t\tbodyScroll: function getBodyScrollWidth(){\n\t\t\t\treturn document.body.scrollWidth;\n\t\t\t},\n\n\t\t\tdocumentElementScroll: function getDEScrollWidth(){\n\t\t\t\treturn document.documentElement.scrollWidth;\n\t\t\t},\n\n\t\t\tmax: function getMaxWidth(){\n\t\t\t\treturn Math.max(getWidth.bodyScroll(), getWidth.documentElementScroll());\n\t\t\t},\n\n\t\t\tleftMostElement: function getLeftMostElement(){\n\t\t\t\treturn getMaxElement('left', getAllElements());\n\t\t\t},\n\n\t\t\ttaggedElement: function getTaggedElementsWidth(){\n\t\t\t\treturn getTaggedElements('left', 'data-iframe-width');\n\t\t\t}\n\t\t};\n\n\n\tfunction sendSize(triggerEvent, triggerEventDesc, customHeight, customWidth){\n\n\t\tvar\tcurrentHeight,currentWidth;\n\n\t\tfunction recordTrigger(){\n\t\t\tif (!(triggerEvent in {'reset':1,'resetPage':1,'init':1})){\n\t\t\t\tlog( 'Trigger event: ' + triggerEventDesc );\n\t\t\t}\n\t\t}\n\n\t\tfunction resizeIFrame(){\n\t\t\theight = currentHeight;\n\t\t\twidth  = currentWidth;\n\n\t\t\tsendMsg(height,width,triggerEvent);\n\t\t}\n\n\t\tfunction isDoubleFiredEvent(){\n\t\t\treturn  triggerLocked && (triggerEvent in doubleEventList);\n\t\t}\n\n\t\tfunction isSizeChangeDetected(){\n\t\t\tfunction checkTolarance(a,b){\n\t\t\t\tvar retVal = Math.abs(a-b) <= tolerance;\n\t\t\t\treturn !retVal;\n\t\t\t}\n\n\t\t\tcurrentHeight = (undefined !== customHeight)  ? customHeight : getHeight[heightCalcMode]();\n\t\t\tcurrentWidth  = (undefined !== customWidth )  ? customWidth  : getWidth[widthCalcMode]();\n\n\t\t\treturn\tcheckTolarance(height,currentHeight) || (calculateWidth && checkTolarance(width,currentWidth));\n\t\t}\n\n\t\tfunction isForceResizableEvent(){\n\t\t\treturn !(triggerEvent in {'init':1,'interval':1,'size':1});\n\t\t}\n\n\t\tfunction isForceResizableHeightCalcMode(){\n\t\t\treturn (heightCalcMode in resetRequiredMethods);\n\t\t}\n\n\t\tfunction logIgnored(){\n\t\t\tlog('No change in size detected');\n\t\t}\n\n\t\tfunction checkDownSizing(){\n\t\t\tif (isForceResizableEvent() && isForceResizableHeightCalcMode()){\n\t\t\t\tresetIFrame(triggerEventDesc);\n\t\t\t} else if (!(triggerEvent in {'interval':1})){\n\t\t\t\trecordTrigger();\n\t\t\t\tlogIgnored();\n\t\t\t}\n\t\t}\n\n\t\tif (!isDoubleFiredEvent()){\n\t\t\tif (isSizeChangeDetected() || 'init' === triggerEvent){\n\t\t\t\trecordTrigger();\n\t\t\t\tlockTrigger();\n\t\t\t\tresizeIFrame();\n\t\t\t} else {\n\t\t\t\tcheckDownSizing();\n\t\t\t}\n\t\t} else {\n\t\t\tlog('Trigger event cancelled: '+triggerEvent);\n\t\t}\n\t}\n\n\tfunction lockTrigger(){\n\t\tif (!triggerLocked){\n\t\t\ttriggerLocked = true;\n\t\t\tlog('Trigger event lock on');\n\t\t}\n\t\tclearTimeout(triggerLockedTimer);\n\t\ttriggerLockedTimer = setTimeout(function(){\n\t\t\ttriggerLocked = false;\n\t\t\tlog('Trigger event lock off');\n\t\t\tlog('--');\n\t\t},eventCancelTimer);\n\t}\n\n\tfunction triggerReset(triggerEvent){\n\t\theight = getHeight[heightCalcMode]();\n\t\twidth  = getWidth[widthCalcMode]();\n\n\t\tsendMsg(height,width,triggerEvent);\n\t}\n\n\tfunction resetIFrame(triggerEventDesc){\n\t\tvar hcm = heightCalcMode;\n\t\theightCalcMode = heightCalcModeDefault;\n\n\t\tlog('Reset trigger event: ' + triggerEventDesc);\n\t\tlockTrigger();\n\t\ttriggerReset('reset');\n\n\t\theightCalcMode = hcm;\n\t}\n\n\tfunction sendMsg(height,width,triggerEvent,msg,targetOrigin){\n\t\tfunction setTargetOrigin(){\n\t\t\tif (undefined === targetOrigin){\n\t\t\t\ttargetOrigin = targetOriginDefault;\n\t\t\t} else {\n\t\t\t\tlog('Message targetOrigin: '+targetOrigin);\n\t\t\t}\n\t\t}\n\n\t\tfunction sendToParent(){\n\t\t\tvar\n\t\t\t\tsize  = height + ':' + width,\n\t\t\t\tmessage = myID + ':' +  size + ':' + triggerEvent + (undefined !== msg ? ':' + msg : '');\n\n\t\t\tlog('Sending message to host page (' + message + ')');\n\t\t\ttarget.postMessage( msgID + message, targetOrigin);\n\t\t}\n\n\t\tsetTargetOrigin();\n\t\tsendToParent();\n\t}\n\n\tfunction receiver(event) {\n\t\tfunction isMessageForUs(){\n\t\t\treturn msgID === (''+event.data).substr(0,msgIdLen); //''+ Protects against non-string messages\n\t\t}\n\n\t\tfunction initFromParent(){\n\t\t\tinitMsg = event.data;\n\t\t\ttarget  = event.source;\n\n\t\t\tinit();\n\t\t\tfirstRun = false;\n\t\t\tsetTimeout(function(){ initLock = false;},eventCancelTimer);\n\t\t}\n\n\t\tfunction resetFromParent(){\n\t\t\tif (!initLock){\n\t\t\t\tlog('Page size reset by host page');\n\t\t\t\ttriggerReset('resetPage');\n\t\t\t} else {\n\t\t\t\tlog('Page reset ignored by init');\n\t\t\t}\n\t\t}\n\n\t\tfunction resizeFromParent(){\n\t\t\tsendSize('resizeParent','Parent window resized');\n\t\t}\n\n\t\tfunction getMessageType(){\n\t\t\treturn event.data.split(']')[1];\n\t\t}\n\n\t\tfunction isMiddleTier(){\n\t\t\treturn ('iFrameResize' in window);\n\t\t}\n\n\t\tfunction isInitMsg(){\n\t\t\t//Test if this message is from a child below us. This is an ugly test, however, updating\n\t\t\t//the message format would break backwards compatibity.\n\t\t\treturn event.data.split(':')[2] in {'true':1,'false':1};\n\t\t}\n\n\t\tif (isMessageForUs()){\n\t\t\tif (false === firstRun) {\n\t\t\t\tswitch (getMessageType()){\n\t\t\t\tcase 'reset':\n\t\t\t\t\tresetFromParent();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'resize':\n\t\t\t\t\tresizeFromParent();\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tif (!isMiddleTier() && !isInitMsg()){\n\t\t\t\t\t\twarn('Unexpected message ('+event.data+')');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (isInitMsg()) {\n\t\t\t\tinitFromParent();\n\t\t\t} else {\n\t\t\t\tlog('Ignored message of type \"' + getMessageType() + '\". Received before initialization.');\n\t\t\t}\n\t\t}\n\t}\n\n\taddEventListener(window, 'message', receiver);\n\n})();\n"]}